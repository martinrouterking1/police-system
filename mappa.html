<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Modulo Geolocalizzazione</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

  <style>
    body {
      background-color: #050a14;
      color: #7CFC00;
      font-family: monospace;
      padding: 20px;
    }

    .box {
      border: 1px solid #7CFC00;
      padding: 20px;
      max-width: 900px;
      margin: auto;
      background-color: rgba(10,20,40,0.85);
    }

    #map {
      height: 400px;
      margin-top: 15px;
      border: 1px solid #7CFC00;
    }

    .hidden {
      display: none;
      margin-top: 20px;
      color: #4fa3ff;
    }

    button {
      margin-top: 15px;
      padding: 10px;
      width: 100%;
      background: #050a14;
      color: #7CFC00;
      border: 1px solid #7CFC00;
      font-family: monospace;
      cursor: pointer;
    }

    button:hover {
      background: #7CFC00;
      color: #050a14;
    }
  </style>
</head>
<body>

<div class="box">
  <h1>üó∫Ô∏è ANALISI GEO-CRIMINALE</h1>
  <p>
    I dati raccolti indicano che il furto √® avvenuto in un punto preciso.<br>
    Seleziona sulla mappa il luogo che ritieni corretto.
  </p>

  <div id="map"></div>

  <p id="feedback" style="margin-top:10px;"></p>

  <div id="secret" class="hidden">
    <h2>üìç Luogo confermato</h2>
    <p>
      Coordinate validate.<br>
      Sul posto √® presente un ulteriore indizio fisico.
    </p>
    <p>
      <strong>Istruzione operativa:</strong><br>
      Recarsi sul luogo e cercare una busta contrassegnata con il simbolo ‚ô•.
    </p>
  </div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
  // üî¥ COORDINATE REALI (CAMBIALE)
  const targetLat = 41.836750;
  const targetLng = 12.518583;


  const tolerance = 50; // metri

  const map = L.map('map').setView([targetLat, targetLng], 13);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '¬© OpenStreetMap'
  }).addTo(map);

  let marker;

  function distance(lat1, lon1, lat2, lon2) {
    const R = 6371e3;
    const œÜ1 = lat1 * Math.PI/180;
    const œÜ2 = lat2 * Math.PI/180;
    const ŒîœÜ = (lat2-lat1) * Math.PI/180;
    const ŒîŒª = (lon2-lon1) * Math.PI/180;

    const a = Math.sin(ŒîœÜ/2) * Math.sin(ŒîœÜ/2) +
              Math.cos(œÜ1) * Math.cos(œÜ2) *
              Math.sin(ŒîŒª/2) * Math.sin(ŒîŒª/2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

    return R * c;
  }

  map.on('click', function(e) {
    if (marker) map.removeLayer(marker);

    marker = L.marker(e.latlng).addTo(map);

    const d = distance(
      e.latlng.lat,
      e.latlng.lng,
      targetLat,
      targetLng
    );

    const feedback = document.getElementById("feedback");

    if (d <= tolerance) {
      feedback.textContent = "‚úî Coordinate compatibili con i dati investigativi.";
      feedback.style.color = "#7CFC00";
      document.getElementById("secret").style.display = "block";
    } else {
      feedback.textContent = "‚úñ Coordinate non compatibili. Distanza: " + Math.round(d) + " m";
      feedback.style.color = "#ff4f4f";
    }
  });
</script>

</body>
</html>

